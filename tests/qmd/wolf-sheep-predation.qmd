# Wolf Sheep Predation Model Experiments

## Overview

This document tests `logolink` under the different experiments using the *Wolf Sheep Predation* model, included in NetLogo along with the *Sample Models* library.

## Set the Environment

### Load Packages

```{r}
#| label: Set the Environment
#| output: false

library(dplyr)
library(logolink)
```

### Set Model Path

```{r}
model_path <-
  find_netlogo_home() |>
  file.path(
    "models",
    "Sample Models",
    "Biology",
    "Wolf Sheep Predation.nlogox"
  )
```

## Custom Experiments

### Wolf Sheep Simple Model Analysis

#### Create Experiment

```{r}
#| label: Wolf Sheep Simple Model Analysis

setup_file <- create_experiment(
  name = "Wolf Sheep Simple Model Analysis",
  repetitions = 10,
  sequential_run_order = TRUE,
  run_metrics_every_step = TRUE,
  time_limit = 1000,
  setup = 'setup',
  go = 'go',
  run_metrics_condition = NULL,
  metrics = c(
    'count wolves',
    'count sheep'
  ),
  constants = list(
    "model-version" = "sheep-wolves-grass",
    "initial-number-sheep" = 500,
    "sheep-gain-from-food" = 2,
    "initial-number-wolves" = list(
      first = 5,
      step = 1,
      last = 15
    ),
    "wolf-gain-from-food" = 5,
    "wolf-reproduce" = 5,
    "grass-regrowth-time" = 30
  )
)
```

#### Run Experiment

```{r}
#| output: false

results <-
  model_path |>
  run_experiment(
    setup_file = setup_file
  )
```

```{r}
results |> glimpse()
```

###  Agent Attributes Extraction

#### Create Experiment Mirror

```{r}
#| label: Agent Attributes Extraction

setup_file <- create_experiment(
  name = "Agent Attributes Extraction",
  repetitions = 1,
  sequential_run_order = TRUE,
  run_metrics_every_step = TRUE,
  time_limit = 1,
  metrics = c(
    '[who] of sheep',
    '[xcor] of sheep',
    '[ycor] of sheep',
    '[shape] of sheep',
    '[color] of sheep',
    '[who] of wolves',
    '[xcor] of wolves',
    '[ycor] of wolves',
    '[shape] of wolves',
    '[color] of wolves',
    '[pxcor] of patches',
    '[pycor] of patches',
    '[pcolor] of patches'
  ),
  constants = list(
    "model-version" = "sheep-wolves-grass"
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    setup_file = setup_file,
    output = c("table", "lists")
  )
```

```{r}
results |> glimpse()
```

## Predefined Experiments

### BehaviorSpace Combinatorial

#### Create Experiment Mirror

```{r}
#| label: BehaviorSpace Combinatorial

setup_file <- create_experiment(
  name = "BehaviorSpace Combinatorial",
  repetitions = 1,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 1500,
  setup = 'setup',
  go = 'go',
  post_run = 'wait .5',
  run_metrics_condition = 'ticks mod 10 = 0',
  metrics = c(
    'count sheep',
    'count wolves',
    'count grass'
  ),
  constants = list(
    "model-version" = "sheep-wolves-grass",
    "wolf-reproduce" = c(3, 5, 10, 15),
    "wolf-gain-from-food" = c(10, 15, 30, 40)
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "BehaviorSpace combinatorial"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    experiment = experiment
  )
```

```{r}
results |> glimpse()
```

### Behaviorspace Run 3 Experiments

#### Create Experiment Mirror

```{r}
#| label: Behaviorspace Run 3 Experiments

setup_file <- create_experiment(
  name = "Behaviorspace Run 3 Experiments",
  repetitions = 1,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 1500,
  setup = c(
    'setup',
    'print (word "sheep-reproduce: " sheep-reproduce ", wolf-reproduce: " wolf-reproduce)',
    'print (word "sheep-gain-from-food: " sheep-gain-from-food ", wolf-gain-from-food: " wolf-gain-from-food)'
  ),
  go = 'go',
  post_run = c(
    'print (word "sheep: " count sheep ", wolves: " count wolves)',
    'print ""',
    'wait 1'
  ),
  run_metrics_condition = 'ticks mod 10 = 0',
  metrics = c(
    'count sheep',
    'count wolves',
    'count grass'
  ),
  constants = list(
    "model-version" = "sheep-wolves-grass"
  ),
  sub_experiments = list(
    list(
      "sheep-reproduce" = 1,
      "sheep-gain-from-food" = 1,
      "wolf-reproduce" = 2,
      "wolf-gain-from-food" = 10
    ),
    list(
      "sheep-reproduce" = 6,
      "sheep-gain-from-food" = 8,
      "wolf-reproduce" = 5,
      "wolf-gain-from-food" = 20
    ),
    list(
      "sheep-reproduce" = 20,
      "sheep-gain-from-food" = 15,
      "wolf-reproduce" = 15,
      "wolf-gain-from-food" = 30
    )
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "BehaviorSpace run 3 experiments"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    experiment = experiment
  )
```

```{r}
results |> glimpse()
```

### BehaviorSpace Run 3 Variable Values Per Experiments

#### Create Experiment Mirror

```{r}
#| label: BehaviorSpace Run 3 Variable Values Per Experiments

setup_file <- create_experiment(
  name = "BehaviorSpace Run 3 Variable Values Per Experiments",
  repetitions = 1,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 1500,
  setup = c(
    'setup',
    'print (word "sheep-reproduce: " sheep-reproduce ", wolf-reproduce: " wolf-reproduce)',
    'print (word "sheep-gain-from-food: " sheep-gain-from-food ", wolf-gain-from-food: " wolf-gain-from-food)'
  ),
  go = 'go',
  post_run = c(
    'print (word "sheep: " count sheep ", wolves: " count wolves)',
    'print ""',
    'wait 1'
  ),
  run_metrics_condition = 'ticks mod 10 = 0',
  metrics = c(
    'count sheep',
    'count wolves',
    'count grass'
  ),
  constants = list(
    "model-version" = "sheep-wolves-grass",
    "sheep-reproduce" = 4,
    "wolf-reproduce" = 2,
    "sheep-gain-from-food" = 4,
    "wolf-gain-from-food" = 20
  ),
  sub_experiments = list(
    list(
      "sheep-reproduce" = c(1, 6, 20)
    ),
    list(
      "wolf-reproduce" = c(2, 7, 15)
    ),
    list(
      "sheep-gain-from-food" = c(1, 8, 15)
    ),
    list(
      "wolf-gain-from-food" = c(10, 20, 30)
    )
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "BehaviorSpace run 3 variable values per experiments"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    experiment = experiment
  )
```

```{r}
results |> glimpse()
```

### BehaviorSpace Subset

#### Create Experiment Mirror

```{r}
#| label: BehaviorSpace Subset

setup_file <- create_experiment(
  name = "BehaviorSpace Subset",
  repetitions = 1,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 1500,
  setup = 'setup',
  go = 'go',
  post_run = 'wait .5',
  run_metrics_condition = 'ticks mod 10 = 0',
  metrics = c(
    'count sheep',
    'count wolves',
    'count grass'
  ),
  constants = list(
    "model-version" = "sheep-wolves-grass"
  ),
  sub_experiments = list(
    list(
      "wolf-reproduce" = c(3, 5),
      "wolf-gain-from-food" = c(30, 40)
    ),
    list(
      "wolf-reproduce" = c(10, 15),
      "wolf-gain-from-food" = c(10, 15)
    )
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "BehaviorSpace subset"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    experiment = experiment
  )
```

```{r}
results |> glimpse()
```

### New BehaviorSpace Features

#### Create Experiment Mirror

```{r}
#| label: New BehaviorSpace Features

setup_file <- create_experiment(
  name = "New BehaviorSpace Features",
  repetitions = 3,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 200,
  pre_experiment = 'reset-timer',
  setup = 'setup',
  go = 'go',
  post_experiment = 'show timer',
  run_metrics_condition = 'ticks mod 2 = 0',
  metrics = c(
    'count sheep',
    'count wolves',
    '[xcor] of sheep',
    '[ycor] of sheep',
    '[xcor] of wolves',
    '[ycor] of wolves'
  ),
  sub_experiments = list(
    list(
      "wolf-gain-from-food" = list(
        first = 30,
        step = 5,
        last = 50
      )
    )
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "New BehaviorSpace Features"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    experiment = experiment
  )
```

```{r}
results |> glimpse()
```

### New BehaviorSpace Features Reproducible

#### Create Experiment Mirror

```{r}
#| label: New BehaviorSpace Features Reproducible

setup_file <- create_experiment(
  name = "New BehaviorSpace Features Reproducible",
  repetitions = 3,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 200,
  pre_experiment = 'reset-timer',
  setup = c(
    'random-seed (474 + behaviorspace-run-number)',
    '',
    'setup'
  ),
  go = 'go',
  post_experiment = 'show timer',
  run_metrics_condition = 'ticks mod 2 = 0',
  metrics = c(
    'count sheep',
    'count wolves',
    '[xcor] of sheep',
    '[ycor] of sheep',
    '[xcor] of wolves',
    '[ycor] of wolves'
  ),
  constants = list(
    "model-version" = "sheep-wolves-grass",
    "wolf-gain-from-food" = 20,
    "show-energy?" = FALSE,
    "wolf-reproduce" = 5,
    "initial-number-wolves" = 50,
    "initial-number-sheep" = 100
  ),
  sub_experiments = list(
    list(
      "wolf-gain-from-food" = c(10, 20, 30)
    )
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "New BehaviorSpace Features reproducible"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    experiment = experiment
  )
```

```{r}
results |> glimpse()
```

### Wolf Sheep Crossing

#### Create Experiment Mirror

```{r}
#| label: Wolf Sheep Crossing

setup_file <- create_experiment(
  name = "Wolf Sheep Crossing",
  repetitions = 4,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 1500,
  setup = 'setup',
  go = 'go',
  run_metrics_condition = 'count sheep = count wolves',
  metrics = c(
    'count sheep',
    'count wolves'
  ),
  constants = list(
    "wolf-gain-from-food" = 20,
    "show-energy?" = FALSE,
    "wolf-reproduce" = 5,
    "initial-number-wolves" = 50,
    "initial-number-sheep" = 100,
    "model-version" = "sheep-wolves-grass",
    "sheep-gain-from-food" = 4,
    "grass-regrowth-time" = 30,
    "sheep-reproduce" = 4
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "Wolf Sheep Crossing"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(
    experiment = experiment
  )
```

```{r}
results |> glimpse()
```
