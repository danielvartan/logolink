```{r}
#| label: Setup
#| include: false

library(here)

source(here("R", ".setup.R"))
```

## Overview

This document tests `logolink` under the different experiments using the *Voting Sensitivity Analysis* model, included in NetLogo along with the [IABM Textbook](https://mitpress.mit.edu/9780262731898/an-introduction-to-agent-based-modeling/) library.

## Set the Environment

### Load Packages

```{r}
#| label: Set the Environment
#| output: false

library(dplyr)
library(logolink)
```

### Set Model Path

```{r}
model_path <-
  find_netlogo_home() |>
  file.path(
    "models",
    "IABM Textbook",
    "chapter 7",
    "Voting Sensitivity Analysis.nlogox"
  )
```

## Predefined Experiments

### Sensitivity Experiment

#### Create Experiment Mirror

```{r}
#| label: Sensitivity Experiment

setup_file <- create_experiment(
  name = "Sensitivity Experiment",
  repetitions = 10,
  sequential_run_order = TRUE,
  run_metrics_every_step = FALSE,
  time_limit = 100,
  setup = 'setup',
  go = 'go',
  metrics = 'count patches with [ vote = 0 ] / count patches',
  constants = list(
    "initial-green-pct" = list(
      first = 25,
      step = 5,
      last = 75
    ),
    "award-close-calls-to-loser?" = FALSE,
    "change-vote-if-tied?" = FALSE
  )
)
```

```{r}
inspect_experiment_file(setup_file)
```

#### Define Experiment Name

```{r}
experiment <- "sensitivity-experiment"
```

#### Run Experiment

```{r}
results <-
  model_path |>
  run_experiment(experiment = experiment)
```

```{r}
results |> glimpse()
```
